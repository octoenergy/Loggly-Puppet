<% if @enable_tls -%>

##########################################################
### TLS RsyslogTemplate for Loggly
##########################################################

$template LogglyFormat,"<%%pri%>%protocol-version% %timestamp:::date-rfc3339% %HOSTNAME% %app-name% %procid% %msgid% [<%= @customer_token -%>@41058 <% @tags.each do |value| -%>tag=\"<%=value%>\" <% end -%>] %msg%"

#RsyslogGnuTLS

$DefaultNetstreamDriverCAFile <%= @cert_path -%>/loggly_full.crt
$ActionSendStreamDriver gtls
$ActionSendStreamDriverMode 1
$ActionSendStreamDriverAuthMode x509/name
$ActionSendStreamDriverPermittedPeer *.loggly.com

<% @app_names_to_exclude.each do |appname| -%>
  :programname, isequal, "<%= appname -%>" stop
<% end -%>

*.* @@logs-01.loggly.com:6514; LogglyFormat

<% else -%>

##########################################################
### TLS RsyslogTemplate for Loggly
##########################################################

$template LogglyFormat,"<%%pri%>%protocol-version% %timestamp:::date-rfc3339% %HOSTNAME% %app-name% %procid% %msgid% [<%= @customer_token -%>@41058 <% @tags.each do |value| -%>tag=\"<%=value%>\" <% end -%>] %msg%\n"

<% @app_names_to_exclude.each do |appname| -%>
  :programname, isequal, "<%= appname -%>" stop
<% end -%>

<% end -%>
#################END CONFIG FILE#########################
